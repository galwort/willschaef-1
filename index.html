<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorcerers Battle</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
            background: #000;
            margin: auto;
        }
        #loadingScreen, #fightingScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
        }
        #loadingScreen {
            background: rgba(0, 0, 0, 0.8);
        }
        #characterSelection {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .character-container, .shop-item {
            text-align: center;
        }
        .character, .shop-img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .character.selected, .shop-item.available {
            border-color: yellow;
        }
        .character-name, .shop-name {
            margin-top: 10px;
            font-size: 16px;
            color: white;
        }
        #shop {
            margin-top: 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        #startGame, #abilityButton {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        #abilityButton {
            display: none;
        }
        #timer {
            font-size: 24px;
        }
        #cooldown {
            font-size: 16px;
            color: red;
        }
        .blast {
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: rgba(255, 0, 0, 0.7);
            pointer-events: none;
            transform: translate(-50%, -50%);
            display: none;
        }
    </style>
</head>
<body>
    <audio id="background-music" src="background.mp3" loop></audio>
    <img id="basketImage" src="gojo.png" style="display: none;">
    <img id="bulletImage" src="orb.png" style="display: none;">
    <img id="curseImage" src="curse.png" style="display: none;">
    <img id="gojo2Image" src="gojo2.webp" style="display: none;">
    
    <div id="loadingScreen">
        <h1>Sorcerers Battle</h1>
        <h2>Select Your Character</h2>
        <div id="characterSelection">
            <div class="character-container">
                <img src="gojo.png" alt="Character 1" class="character" data-character="character1">
                <div class="character-name">Gojo</div>
            </div>
            <div class="character-container">
                <img src="yuji.png" alt="Character 2" class="character" data-character="character2">
                <div class="character-name">Yuji</div>
            </div>
        </div>
        <h2>Shop</h2>
        <div id="shop">
            <div class="shop-item available" data-character="character3">
                <img src="yuta.png" alt="New Character" class="shop-img">
                <div class="shop-name">Yuta</div>
                <button class="buy-button" data-price="100">Buy (100 Gold)</button>
            </div>
        </div>
        <button id="startGame">Start Game</button>
    </div>

    <div id="fightingScreen" style="display: none;">
        <div id="timer">30</div>
        <div id="cooldown">Ability Cooldown: 30s</div>
        <button id="abilityButton">Use Reversal Red</button>
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="blastEffect" class="blast"></div>
    </div>

    <script>
        let selectedCharacter;
        let player = { x: 100, y: 100, width: 100, height: 100, img: new Image(), speed: 7 };
        let enemy = { x: 300, y: 300, width: 100, height: 100, img: new Image(), speed: 3 };
        let bullets = [];
        const bulletSpeed = 5;
        let ctx;
        let canvas;
        let timer;
        let cooldownTimer;
        let isAbilityAvailable = false;
        let abilityCooldown = 30; // seconds
        let abilityReady = true; // track if ability is ready
        let gold = 200; // Example gold amount for shop logic

        const characters = {
            character1: {
                selectionImg: 'gojo.png',
                fightingImg: 'gojo2.webp',
                width: 100,
                height: 100,
                speed: 7,
                unlocked: true
            },
            character2: {
                selectionImg: 'yuji.png',
                fightingImg: 'yuji_fight.png',
                width: 100,
                height: 100,
                speed: 5,
                unlocked: true
            },
            character3: {
                selectionImg: 'yuta.png',
                fightingImg: 'yuta_fight.png',
                width: 100,
                height: 100,
                speed: 6,
                unlocked: false
            }
        };

        function initialize() {
            document.getElementById('characterSelection').addEventListener('click', function(e) {
                if (e.target.classList.contains('character')) {
                    document.querySelectorAll('.character').forEach(char => char.classList.remove('selected'));
                    e.target.classList.add('selected');
                    selectedCharacter = e.target.getAttribute('data-character');
                    console.log('Selected Character:', selectedCharacter);
                }
            });

            document.getElementById('shop').addEventListener('click', function(e) {
                if (e.target.classList.contains('buy-button')) {
                    const item = e.target.parentElement;
                    const character = item.getAttribute('data-character');
                    const price = parseInt(e.target.getAttribute('data-price'), 10);

                    if (characters[character] && !characters[character].unlocked) {
                        if (gold >= price) {
                            characters[character].unlocked = true;
                            gold -= price;
                            updateShopVisibility();
                            console.log('Bought:', character);
                        } else {
                            alert('Not enough gold!');
                        }
                    }
                }
            });

            document.getElementById('startGame').addEventListener('click', function() {
                if (selectedCharacter && characters[selectedCharacter] && characters[selectedCharacter].unlocked) {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('fightingScreen').style.display = 'block';
                    initializeGame();
                    startTimer();
                    update();
                } else {
                    alert('Please select an unlocked character.');
                }
            });

            document.getElementById('abilityButton').addEventListener('click', function() {
                useReversalRed();
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'ArrowRight') player.x += player.speed;
                if (e.key === 'ArrowLeft') player.x -= player.speed;
                if (e.key === 'ArrowUp') player.y -= player.speed;
                if (e.key === 'ArrowDown') player.y += player.speed;
                if (e.key === ' ' && abilityReady) { // Spacebar to shoot
                    bullets.push({
                        x: player.x + player.width / 2 - 25,
                        y: player.y
                    });
                }
                if (e.key === 'r' && isAbilityAvailable && abilityReady) { // 'R' key to use Reversal Red
                    useReversalRed();
                }
            });
        }

        function updateShopVisibility() {
            document.querySelectorAll('.shop-item').forEach(item => {
                const character = item.getAttribute('data-character');
                if (characters[character].unlocked) {
                    item.querySelector('.buy-button').style.display = 'none';
                    item.classList.remove('locked');
                } else {
                    item.querySelector('.buy-button').style.display = 'block';
                    item.classList.add('locked');
                }
            });
        }

        function initializeGame() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');

            const selectedCharacterData = characters[selectedCharacter];
            if (selectedCharacterData) {
                player.img.src = selectedCharacterData.fightingImg;
                player.width = selectedCharacterData.width;
                player.height = selectedCharacterData.height;
                player.speed = selectedCharacterData.speed;
                player.img.onload = function() {
                    drawPlayer();
                };

                enemy.img.src = 'curse.png';
                enemy.width = 100;
                enemy.height = 100;
                enemy.img.onload = function() {
                    drawEnemy();
                };
            } else {
                console.error('Selected character data not found');
            }
        }

        function drawImage(img, x, y, width, height) {
            ctx.drawImage(img, x, y, width, height);
        }

        function drawPlayer() {
            drawImage(player.img, player.x, player.y, player.width, player.height);
        }

        function drawEnemy() {
            drawImage(enemy.img, enemy.x, enemy.y, enemy.width, enemy.height);
        }

        function drawBullets() {
            bullets.forEach(bullet => {
                drawImage(document.getElementById('bulletImage'), bullet.x, bullet.y, 50, 50);
            });
        }

        function updateBullets() {
            bullets.forEach(bullet => {
                bullet.y -= bulletSpeed;
            });
            bullets = bullets.filter(bullet => bullet.y > 0);
        }

        function updateEnemy() {
            if (player.x < enemy.x) enemy.x -= enemy.speed;
            if (player.x > enemy.x) enemy.x += enemy.speed;
            if (player.y < enemy.y) enemy.y -= enemy.speed;
            if (player.y > enemy.y) enemy.y += enemy.speed;
        }

        function checkCollisions() {
            bullets.forEach(bullet => {
                if (bullet.x < enemy.x + enemy.width &&
                    bullet.x + 50 > enemy.x &&
                    bullet.y < enemy.y + enemy.height &&
                    bullet.y + 50 > enemy.y) {
                    console.log('Hit detected!');
                    enemy.x = Math.random() * (canvas.width - enemy.width);
                    enemy.y = Math.random() * (canvas.height - enemy.height);
                }
            });
        }

        function useReversalRed() {
            if (isAbilityAvailable && abilityReady) {
                showBlastEffect(enemy.x + enemy.width / 2, enemy.y + enemy.height / 2);
                enemy.x = -1000; // Move enemy off-screen to simulate death
                console.log('Reversal Red used!');
                abilityReady = false;
                document.getElementById('abilityButton').style.display = 'none';

                setTimeout(() => {
                    abilityReady = true;
                    document.getElementById('abilityButton').style.display = 'block';
                    console.log('Ability is ready to use again!');
                }, abilityCooldown * 1000);
            } else if (!isAbilityAvailable) {
                console.log('Ability not available yet.');
            }
        }

        function showBlastEffect(x, y) {
            const blast = document.getElementById('blastEffect');
            blast.style.left = `${x}px`;
            blast.style.top = `${y}px`;
            blast.style.display = 'block';

            setTimeout(() => {
                blast.style.display = 'none';
            }, 500); // Display blast effect for 0.5 seconds
        }

        function startTimer() {
            let timeLeft = 30;
            timer = setInterval(function() {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    isAbilityAvailable = true; // Enable ability after the timer ends
                    document.getElementById('cooldown').textContent = 'Ability Cooldown: 30s';
                    document.getElementById('abilityButton').style.display = 'block'; // Show ability button
                }
            }, 1000);
        }

        function update() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawPlayer();
            drawEnemy();
            drawBullets();
            updateBullets();
            updateEnemy();
            checkCollisions();
            requestAnimationFrame(update);
        }

        window.onload = function() {
            initialize();
            updateShopVisibility();
            document.getElementById('background-music').play();
        };
    </script>
</body>
</html>
